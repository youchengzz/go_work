<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>账户访问 - 登录与注册</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .transition-custom {
        transition: all 0.3s ease;
      }
      .loading-spinner {
        border-top-color: currentColor;
        animation: spinner 0.8s linear infinite;
      }
      @keyframes spinner {
        to { transform: rotate(360deg); }
      }
    }
  </style>
  
  <style>
    /* 输入框浮动标签效果 */
    .form-input:focus + .floating-label,
    .form-input:not(:placeholder-shown) + .floating-label {
      transform: translateY(-1.5rem) scale(0.85);
      color: #165DFF;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 flex items-center justify-center p-4">
  <!-- 主卡片容器 -->
  <div class="w-full max-w-md bg-white rounded-xl shadow-md overflow-hidden">
    <!-- 标题区域 -->
    <div class="bg-primary p-6 text-white text-center">
      <h1 class="text-2xl font-bold">账户访问</h1>
      <p class="opacity-90 mt-1">登录或注册以继续</p>
    </div>
    
    <!-- 切换标签 -->
    <div class="flex border-b">
      <button id="login-tab" class="flex-1 py-3 font-medium text-primary border-b-2 border-primary transition-custom">
        登录
      </button>
      <button id="register-tab" class="flex-1 py-3 font-medium text-gray-500 hover:text-primary transition-custom">
        注册
      </button>
    </div>
    
    <!-- 表单区域 -->
    <div class="p-6">
      <!-- 登录表单 - 修改为用户名登录 -->
      <div id="login-form">
        <div class="space-y-4">
          <div class="relative">
            <input type="text" id="login-username" class="form-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-custom placeholder-transparent" placeholder="用户名">
            <label for="login-username" class="floating-label absolute left-4 top-3 text-gray-500 transition-custom pointer-events-none">用户名</label>
            <div class="error-message text-red-500 text-sm mt-1 hidden">请输入用户名</div>
          </div>
          
          <div class="relative">
            <input type="password" id="login-password" class="form-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-custom placeholder-transparent" placeholder="密码">
            <label for="login-password" class="floating-label absolute left-4 top-3 text-gray-500 transition-custom pointer-events-none">密码</label>
            <button type="button" class="toggle-password absolute right-4 top-3 text-gray-500 hover:text-primary transition-custom">
              <i class="fa fa-eye-slash"></i>
            </button>
            <div class="error-message text-red-500 text-sm mt-1 hidden">密码长度至少为6位</div>
          </div>
          
          <div class="flex justify-between items-center">
            <label class="flex items-center cursor-pointer">
              <input type="checkbox" class="h-4 w-4 text-primary rounded border-gray-300 focus:ring-primary">
              <span class="ml-2 text-gray-600 text-sm">记住我</span>
            </label>
            <a href="#" class="text-primary hover:text-primary/80 text-sm transition-custom">忘记密码？</a>
          </div>
          
          <button id="login-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom flex items-center justify-center">
            <span id="login-btn-text">登录</span>
            <span id="login-loading" class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full loading-spinner"></span>
          </button>
        </div>
      </div>
      
      <!-- 注册表单 -->
      <div id="register-form" class="hidden">
        <div class="space-y-4">
          <div class="relative">
            <input type="text" id="register-username" class="form-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-custom placeholder-transparent" placeholder="用户名">
            <label for="register-username" class="floating-label absolute left-4 top-3 text-gray-500 transition-custom pointer-events-none">用户名</label>
            <div class="error-message text-red-500 text-sm mt-1 hidden">请输入用户名</div>
          </div>
          
          <div class="relative">
            <input type="email" id="register-email" class="form-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-custom placeholder-transparent" placeholder="邮箱">
            <label for="register-email" class="floating-label absolute left-4 top-3 text-gray-500 transition-custom pointer-events-none">邮箱</label>
            <div class="error-message text-red-500 text-sm mt-1 hidden">请输入有效的邮箱地址</div>
          </div>
          
          <div class="relative">
            <input type="password" id="register-password" class="form-input w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-custom placeholder-transparent" placeholder="密码">
            <label for="register-password" class="floating-label absolute left-4 top-3 text-gray-500 transition-custom pointer-events-none">密码</label>
            <button type="button" class="toggle-password absolute right-4 top-3 text-gray-500 hover:text-primary transition-custom">
              <i class="fa fa-eye-slash"></i>
            </button>
            <div class="error-message text-red-500 text-sm mt-1 hidden">密码长度至少为6位</div>
          </div>
          
          <label class="flex items-start cursor-pointer">
            <input type="checkbox" id="agree-terms" class="h-4 w-4 mt-1 text-primary rounded border-gray-300 focus:ring-primary">
            <span class="ml-2 text-gray-600 text-sm">
              我已阅读并同意<a href="#" class="text-primary hover:underline">服务条款</a>
            </span>
          </label>
          <div class="error-message text-red-500 text-sm mt-1 hidden">请同意服务条款</div>
          
          <button id="register-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom flex items-center justify-center">
            <span id="register-btn-text">注册</span>
            <span id="register-loading" class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full loading-spinner"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 页脚 -->
  <div class="text-center mt-6 text-gray-500 text-sm">
    <p>&copy; 2023 账户系统</p>
  </div>

  <!-- 提示弹窗 -->
  <div id="modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform transition-all scale-95 opacity-0" id="modal-content">
      <div class="text-center">
        <div id="modal-icon" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"></div>
        <h3 class="text-xl font-bold text-gray-800 mb-2" id="modal-title">操作结果</h3>
        <p class="text-gray-600 mb-6" id="modal-message">消息内容</p>
        <button id="modal-close" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-custom">
          确定
        </button>
      </div>
    </div>
  </div>

  <script>
    // DOM元素
    const loginTab = document.getElementById('login-tab');
    const registerTab = document.getElementById('register-tab');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const loginBtn = document.getElementById('login-btn');
    const loginBtnText = document.getElementById('login-btn-text');
    const loginLoading = document.getElementById('login-loading');
    const registerBtn = document.getElementById('register-btn');
    const registerBtnText = document.getElementById('register-btn-text');
    const registerLoading = document.getElementById('register-loading');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    const modalIcon = document.getElementById('modal-icon');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const modalClose = document.getElementById('modal-close');
    const togglePasswordBtns = document.querySelectorAll('.toggle-password');
    
    // 切换登录/注册表单
    loginTab.addEventListener('click', () => {
      loginTab.classList.add('text-primary', 'border-b-2', 'border-primary');
      loginTab.classList.remove('text-gray-500');
      registerTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
      registerTab.classList.add('text-gray-500');
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
      clearErrors();
    });
    
    registerTab.addEventListener('click', () => {
      registerTab.classList.add('text-primary', 'border-b-2', 'border-primary');
      registerTab.classList.remove('text-gray-500');
      loginTab.classList.remove('text-primary', 'border-b-2', 'border-primary');
      loginTab.classList.add('text-gray-500');
      registerForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
      clearErrors();
    });
    
    // 密码显示/隐藏切换
    togglePasswordBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const input = btn.previousElementSibling.previousElementSibling;
        const icon = btn.querySelector('i');
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        } else {
          input.type = 'password';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        }
      });
    });
    
    // 登录表单提交 - 修改为用户名登录
    loginBtn.addEventListener('click', async () => {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      let isValid = true;
      
      // 用户名验证
      if (!username) {
        showError('login-username', '请输入用户名');
        isValid = false;
      } else {
        hideError('login-username');
      }
      
      // 密码验证
      if (!password || password.length < 6) {
        showError('login-password', '密码长度至少为6位');
        isValid = false;
      } else {
        hideError('login-password');
      }
      
      if (isValid) {
        // 显示加载状态
        loginBtn.disabled = true;
        loginBtnText.textContent = '登录中';
        loginLoading.classList.remove('hidden');
        
        try {
          // 发送登录请求 - 使用用户名和密码
          const response = await fetch('http://127.0.0.1:8080/belogs/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password }),  // 发送用户名而非邮箱
            credentials: 'include'
          });
          
          const result = await response.json();
          
          if (response.ok) {
            showModal('success', '登录成功', result.message || '欢迎回来！');
          } else {
            showModal('error', '登录失败', result.message || '用户名或密码不正确');
          }
        } catch (error) {
          showModal('error', '连接失败', '无法连接到服务器，请检查网络');
          console.error('登录请求失败:', error);
        } finally {
          // 恢复按钮状态
          loginBtn.disabled = false;
          loginBtnText.textContent = '登录';
          loginLoading.classList.add('hidden');
        }
      }
    });
    
    // 注册表单提交 - 增加用户名字段
    registerBtn.addEventListener('click', async () => {
      const username = document.getElementById('register-username').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const agreeTerms = document.getElementById('agree-terms').checked;
      let isValid = true;
      
      // 用户名验证
      if (!username) {
        showError('register-username', '请输入用户名');
        isValid = false;
      } else {
        hideError('register-username');
      }
      
      // 邮箱验证
      if (!email || !/\S+@\S+\.\S+/.test(email)) {
        showError('register-email', '请输入有效的邮箱地址');
        isValid = false;
      } else {
        hideError('register-email');
      }
      
      // 密码验证
      if (!password || password.length < 6) {
        showError('register-password', '密码长度至少为6位');
        isValid = false;
      } else {
        hideError('register-password');
      }
      
      // 同意条款验证
      if (!agreeTerms) {
        const termsError = document.querySelector('#register-form .error-message:last-of-type');
        termsError.classList.remove('hidden');
        isValid = false;
      } else {
        const termsError = document.querySelector('#register-form .error-message:last-of-type');
        termsError.classList.add('hidden');
      }
      
      if (isValid) {
        // 显示加载状态
        registerBtn.disabled = true;
        registerBtnText.textContent = '注册中';
        registerLoading.classList.remove('hidden');
        
        try {
          // 发送注册请求到指定接口 - 包含用户名
          const response = await fetch('http://127.0.0.1:8080/belogs/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, email, password }),  // 包含用户名
            credentials: 'include'
          });
          
          const result = await response.json();
          
          if (response.ok) {
            showModal('success', '注册成功', result.message || '账号注册成功，请登录');
            // 注册成功后切换到登录表单
            setTimeout(() => {
              closeModal();
              loginTab.click();
            }, 1500);
          } else {
            showModal('error', '注册失败', result.message || '注册过程中出现错误');
          }
        } catch (error) {
          showModal('error', '连接失败', '无法连接到服务器，请检查网络');
          console.error('注册请求失败:', error);
        } finally {
          // 恢复按钮状态
          registerBtn.disabled = false;
          registerBtnText.textContent = '注册';
          registerLoading.classList.add('hidden');
        }
      }
    });
    
    // 显示错误提示
    function showError(inputId, message) {
      const input = document.getElementById(inputId);
      const errorElement = input.nextElementSibling.nextElementSibling;
      errorElement.textContent = message;
      errorElement.classList.remove('hidden');
      input.classList.add('border-red-500');
      input.classList.remove('border-gray-300', 'focus:border-primary');
    }
    
    // 隐藏错误提示
    function hideError(inputId) {
      const input = document.getElementById(inputId);
      const errorElement = input.nextElementSibling.nextElementSibling;
      errorElement.classList.add('hidden');
      input.classList.remove('border-red-500');
      input.classList.add('border-gray-300', 'focus:border-primary');
    }
    
    // 清除所有错误提示
    function clearErrors() {
      const errorElements = document.querySelectorAll('.error-message');
      errorElements.forEach(el => el.classList.add('hidden'));
      
      const inputs = document.querySelectorAll('.form-input');
      inputs.forEach(input => {
        input.classList.remove('border-red-500');
        input.classList.add('border-gray-300', 'focus:border-primary');
      });
    }
    
    // 显示提示弹窗
    function showModal(type, title, message) {
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      
      // 设置弹窗图标
      if (type === 'success') {
        modalIcon.className = 'w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4';
        modalIcon.innerHTML = '<i class="fa fa-check text-green-500 text-2xl"></i>';
      } else {
        modalIcon.className = 'w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4';
        modalIcon.innerHTML = '<i class="fa fa-times text-red-500 text-2xl"></i>';
      }
      
      modal.classList.remove('hidden');
      
      // 触发动画
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
      }, 10);
    }
    
    // 关闭弹窗
    function closeModal() {
      modalContent.classList.remove('scale-100', 'opacity-100');
      modalContent.classList.add('scale-95', 'opacity-0');
      
      setTimeout(() => {
        modal.classList.add('hidden');
      }, 300);
    }
    
    // 关闭弹窗按钮事件
    modalClose.addEventListener('click', closeModal);
    
    // 点击弹窗外部关闭弹窗
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
    
    // 输入框实时验证
    const formInputs = document.querySelectorAll('.form-input');
    formInputs.forEach(input => {
      input.addEventListener('blur', () => {
        const inputId = input.id;
        
        // 登录表单验证
        if (inputId === 'login-username' && input.value) {
          hideError(inputId);
        }
        
        if (inputId === 'login-password' && input.value) {
          if (input.value.length < 6) {
            showError(inputId, '密码长度至少为6位');
          } else {
            hideError(inputId);
          }
        }
        
        // 注册表单验证
        if (inputId === 'register-username' && input.value) {
          hideError(inputId);
        }
        
        if (inputId === 'register-email' && input.value) {
          if (!/\S+@\S+\.\S+/.test(input.value)) {
            showError(inputId, '请输入有效的邮箱地址');
          } else {
            hideError(inputId);
          }
        }
        
        if (inputId === 'register-password' && input.value) {
          if (input.value.length < 6) {
            showError(inputId, '密码长度至少为6位');
          } else {
            hideError(inputId);
          }
        }
      });
    });
    
    // 条款勾选事件
    document.getElementById('agree-terms').addEventListener('change', function() {
      const termsError = document.querySelector('#register-form .error-message:last-of-type');
      if (this.checked) {
        termsError.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
